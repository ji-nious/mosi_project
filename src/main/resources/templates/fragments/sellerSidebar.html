<!-- templates/fragments/sellerSidebar.html -->
<aside th:fragment="sellerSidebar(activePath, sp)"
       xmlns:th="http://www.thymeleaf.org"
       xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
       th:if="${session.loginRole == 'SELLER'}"
       id="SELLER_SIDEBAR" data-frag="SELLER-SIDEBAR">

  <div class="sidebar-card">
    <div class="profile-box">
      <div class="profile-image">
        <!-- ✅ 타입 가드 후 프로퍼티 접근 -->
        <img th:if="${sp instanceof T(com.KDT.mosi.domain.entity.SellerPage) and sp.image != null}"
             th:src="@{/mypage/seller/images/profile/{id}(id=${sp.pageId})}"
             alt="프로필 이미지">

        <img th:unless="${sp instanceof T(com.KDT.mosi.domain.entity.SellerPage) and sp.image != null}"
             th:src="@{/img/default-profile.png}"
             alt="기본 프로필 이미지">
      </div>

      <div class="profile-info">
        <a href="#" class="profile-badge">프로가이드 ></a>

        <!-- ✅ 닉네임도 타입 가드 포함 -->
        <div class="profile-name"
             th:text="${sp instanceof T(com.KDT.mosi.domain.entity.SellerPage) and sp.nickname != null
                        ? sp.nickname
                        : (session.loginMember != null ? session.loginMember.nickname : '닉네임')}">
          닉네임
        </div>

        <!-- 역할 전환: POST + CSRF -->
        <form th:action="@{/mypage/role/toBuyer}" method="post" style="margin-top:10px;" sec:authorize="isAuthenticated()">
          <input type="hidden" sec:csrf/>
          <button type="submit" class="btn-role-switch">구매자 전환</button>
        </form>
      </div>
    </div>

    <nav class="mypage-nav">
      <div class="nav-title active">MY PAGE</div>
      <ul>
        <li><a href="#">상품</a>
          <ul>
            <li><a th:href="@{/product/manage}">내 상품 목록</a></li>
            <li><a th:href="@{/product/upload}">상품 등록</a></li>
          </ul>
        </li>
        <li><a href="#">판매 현황</a>
          <ul>
            <li><a href="#">주문 현황</a></li>
            <li><a href="#">총 판매수 / 매출액</a></li>
            <li><a href="#">판매 통계</a></li>
          </ul>
        </li>
        <li><a href="#">문의 / 리뷰</a>
          <ul>
            <li><a href="#">상품 문의</a></li>
            <li><a href="#">나의 답글</a></li>
          </ul>
        </li>
        <li><a href="#">알림 / 공지</a>
          <ul>
            <li><a href="#">공지사항</a></li>
            <li><a href="#">프로모션</a></li>
          </ul>
        </li>
        <li><a href="#">내 정보</a>
          <ul>
            <li>
              <a th:href="@{/mypage/seller/view}"
                 th:classappend="${(activePath != null and #strings.startsWith(activePath, '/mypage/seller/view')) ? ' is-active' : ''}">
                프로필
              </a>
            </li>
            <li>
              <a th:href="@{/members/verify-password(next='/members/password')}"
                 th:classappend="${(activePath != null and #strings.startsWith(activePath, '/members/password')) ? ' is-active' : ''}">
                비밀번호 변경
              </a>
            </li>
            <li><a href="#">정산 정보 관리</a></li>
            <li><a href="#">구독자 관리</a></li>
          </ul>
        </li>
        <li><a href="#">고객센터</a>
          <ul>
            <li><a href="#">1:1 문의</a></li>
            <li><a href="#">판매 Q&amp;A 내역</a></li>
            <li><a href="#">공지사항</a></li>
            <li><a href="#">FAQ</a></li>
            <li><a href="#">고객의 소리</a></li>
          </ul>
        </li>
      </ul>
    </nav>
  </div>
</aside>
