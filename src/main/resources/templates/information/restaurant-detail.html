<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title th:text="${restaurant.mainTitle} + ' - 부산 맛집'">맛집 상세</title>

    <!-- CSS -->
    <link rel="stylesheet" th:href="@{/css/layout.css}">
    <link rel="stylesheet" th:href="@{/css/common.css}">
    <link rel="stylesheet" th:href="@{/css/information/restaurant-detail.css}">

    <!-- 외부 폰트 및 아이콘 -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/pretendard@1.3.8/dist/web/static/pretendard.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">

    <!-- 카카오맵 API -->
    <script type="text/javascript" th:src="@{'//dapi.kakao.com/v2/maps/sdk.js?appkey=' + ${kakaoMapApiKey}}"></script>

    <!-- Open Graph Meta Tags -->
    <meta property="og:title" th:content="${restaurant.mainTitle} + ' - 부산 맛집'">
    <meta property="og:description" th:content="${restaurant.itemCntnts ?: '부산의 맛있는 맛집을 소개합니다.'}">
    <meta property="og:image" th:content="${restaurant.mainImgNormal ?: '/img/default-restaurant.png'}">
    <meta property="og:type" content="website">
</head>

<body>
<div class="layout-wrapper">
    <!-- 공통 헤더 -->
    <header th:replace="~{fragments/header :: header}"></header>

    <div class="page-container">
        <main class="restaurant-detail-container">

            <!-- 브레드크럼 네비게이션 -->
            <nav class="breadcrumb">
                <a href="/" class="breadcrumb-item">홈</a>
                <span class="breadcrumb-separator">></span>
                <a href="/information" class="breadcrumb-item">관광 정보</a>
                <span class="breadcrumb-separator">></span>
                <a href="/information" class="breadcrumb-item">부산 맛집</a>
                <span class="breadcrumb-separator">></span>
                <span class="breadcrumb-current" th:text="${restaurant.mainTitle}">맛집명</span>
            </nav>

            <!-- 완전 통합된 평면 구조 -->
            <div class="unified-container">

                <!-- 메인 이미지 -->
                <div class="image-gallery">
                    <div class="main-image">
                        <img th:src="${restaurant.mainImgNormal ?: '/img/default-restaurant.png'}"
                             th:alt="${restaurant.mainTitle}"
                             onerror="this.onerror=null; this.src='/img/default-restaurant.png'">
                    </div>
                </div>

                <!-- 기본 정보 섹션 -->
                <div class="info-section">
                    <div class="title-and-stats">
                        <h1 class="restaurant-title" th:text="${restaurant.mainTitle}">맛집명</h1>

                        <!-- 통계 정보를 우측으로 이동 - span 태그 추가 -->
                        <div class="restaurant-stats">
                            <span class="stat-item" id="viewCountStat">
                                <i class="fas fa-eye"></i>
                                <span>조회수 0</span>
                            </span>
                            <span class="stat-item" id="favoriteCountStat">
                                <i class="fas fa-heart"></i>
                                <span>찜 0</span>
                            </span>
                        </div>
                    </div>

                    <!-- 상세 정보 -->
                    <div class="detail-info">
                        <!-- 대표메뉴 -->
                        <div class="info-item" th:if="${restaurant.rprsnTvMenu}">
                            <div class="info-label">대표메뉴</div>
                            <div class="info-content">
                                <span th:text="${restaurant.rprsnTvMenu}">대표메뉴</span>
                            </div>
                        </div>

                        <!-- 주소 정보 -->
                        <div class="info-item">
                            <div class="info-label">주소</div>
                            <div class="info-content">
                                <span th:text="${restaurant.addr1}">주소 정보</span>
                            </div>
                        </div>

                        <!-- 운영시간 -->
                        <div class="info-item" th:if="${restaurant.usageDayWeekAndTime}">
                            <div class="info-label">운영시간</div>
                            <div class="info-content">
                                <span th:text="${restaurant.usageDayWeekAndTime}">운영시간</span>
                            </div>
                        </div>

                        <!-- 전화번호 -->
                        <div class="info-item" th:if="${restaurant.cntctTel}">
                            <div class="info-label">전화번호</div>
                            <div class="info-content">
                                <span th:text="${restaurant.cntctTel}">전화번호</span>
                            </div>
                        </div>

                        <!-- 홈페이지 -->
                        <div class="info-item" th:if="${restaurant.homepageUrl != null and restaurant.homepageUrl != ''}">
                            <div class="info-label">홈페이지</div>
                            <div class="info-content">
                                <a th:href="${restaurant.homepageUrl}" target="_blank" class="website-link">
                                    홈페이지 바로가기
                                    <i class="fas fa-external-link-alt"></i>
                                </a>
                            </div>
                        </div>
                    </div>

                    <!-- 액션 버튼 -->
                    <div class="action-buttons">
                        <button class="btn btn-primary" onclick="showDirections()">
                            <i class="fas fa-map-marker-alt"></i>
                            길찾기
                        </button>
                        <button class="btn btn-secondary" onclick="shareRestaurant()">
                            <i class="fas fa-share"></i>
                            공유
                        </button>
                        <button class="btn btn-outline" onclick="toggleFavorite()">
                            <i class="far fa-heart"></i>
                            찜하기
                        </button>
                    </div>
                </div>

                <!-- 상세 설명 -->
                <div class="description-section" th:if="${restaurant.itemCntnts}">
                    <h2 class="section-title">상세 정보</h2>
                    <div class="description-content">
                        <p th:text="${restaurant.itemCntnts}">상세 설명</p>
                    </div>
                </div>

                <!-- 위치 지도 -->
                <div class="map-section">
                    <h2 class="section-title">위치</h2>
                    <div class="map-container">
                        <div id="restaurantMap"></div>
                    </div>
                </div>

                <!-- 주변 맛집 -->
                <div class="related-section" th:if="${relatedRestaurants != null and !relatedRestaurants.isEmpty()}">
                    <h2 class="section-title">
                        <span th:text="'주변 ' + ${restaurant.gugunNm} + ' 맛집'">주변 맛집</span>
                    </h2>
                    <div class="related-restaurants">
                        <a th:each="related : ${relatedRestaurants}"
                           th:href="@{'/information/restaurants/' + ${related.ucSeq}}"
                           class="related-item">
                            <div class="related-image">
                                <img th:src="${related.mainImgThumb ?: '/img/default-restaurant.png'}"
                                     th:alt="${related.mainTitle}"
                                     onerror="this.onerror=null; this.src='/img/default-restaurant.png'">
                            </div>
                            <div class="related-info">
                                <h4 th:text="${related.mainTitle}">맛집명</h4>
                                <p th:text="${related.rprsnTvMenu ?: '맛집'}">메뉴</p>
                                <span class="related-link">상세보기 ></span>
                            </div>
                        </a>
                    </div>
                </div>

            </div>

        </main>

        <!-- 하단 네비게이션 -->
        <div class="bottom-nav">
            <a href="/information" class="nav-btn">
                <i class="fas fa-list"></i>
                목록으로
            </a>
        </div>

    </div>

    <!-- 공통 푸터 -->
    <footer th:replace="~{fragments/footer :: footer}"></footer>
</div>

<!-- 공유 모달 -->
<div id="shareModal" class="share-modal">
    <div class="share-modal-content">
        <div class="share-header">
            <h3>공유하기</h3>
            <span class="share-close" onclick="closeShareModal()">&times;</span>
        </div>
        <div class="share-buttons">
            <button class="share-btn kakao" onclick="shareKakao()">카카오톡</button>
            <button class="share-btn facebook" onclick="shareFacebook()">페이스북</button>
            <button class="share-btn twitter" onclick="shareTwitter()">트위터</button>
            <button class="share-btn link" onclick="copyLink()">링크 복사</button>
        </div>
    </div>
</div>

<!-- 토스트 메시지 -->
<div id="toast" class="toast"></div>

<!-- 서버 데이터를 JavaScript 변수로 전달 -->
<script th:inline="javascript">
    console.log('=== 서버에서 전달된 데이터 확인 ===');
    const restaurant = /*[[${restaurant}]]*/ {};
    const kakaoMapApiKey = /*[[${kakaoMapApiKey}]]*/ '';

    console.log('Restaurant 객체:', restaurant);
    console.log('Restaurant 객체의 모든 키:', Object.keys(restaurant));
    console.log('좌표 확인:');
    console.log('- restaurant.lat:', restaurant.lat);
    console.log('- restaurant.lng:', restaurant.lng);
    console.log('- restaurant.LAT:', restaurant.LAT);
    console.log('- restaurant.LNG:', restaurant.LNG);
    console.log('카카오맵 API 키:', kakaoMapApiKey ? '설정됨' : '설정 안됨');
    console.log('===========================================');
</script>

<!-- JavaScript 파일 로드 -->
<script th:src="@{/js/information/restaurant-detail.js}"></script>

</body>
</html>