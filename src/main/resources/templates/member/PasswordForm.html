<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">

<head>
  <meta charset="UTF-8">
  <title>비밀번호 변경</title>
  <link rel="stylesheet" th:href="@{/css/common.css}">
  <link rel="stylesheet" th:href="@{/css/layout.css}">
  <link rel="stylesheet" th:href="@{/css/member/passwordForm.css}">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/pretendard@1.3.8/dist/web/static/pretendard.css">
</head>

<body>
  <div class="layout-wrapper">
    <!-- 헤더  -->
    <th:block th:switch="${session.loginRole ?: 'BUYER'}">
      <header th:case="'SELLER'" th:replace="~{fragments/sellerHeader :: sellerHeader(activeUri=${currentPath ?: ''})}">
      </header>
      <header th:case="*" th:replace="~{fragments/header :: header(activeUri=${currentPath ?: ''})}">
      </header>
    </th:block>

    <div class="page-layout">
      <!-- 사이드바 -->
      <th:block th:switch="${session.loginRole ?: 'BUYER'}">
        <aside th:case="'SELLER'"
               th:replace="~{fragments/sellerSidebar ::
           sellerSidebar(activePath=${'/members/password'}, sp=${sellerPage} ?: null)}">
        </aside>
        <aside th:case="*"
               th:replace="~{fragments/buyerSidebar ::
           buyerSidebar(activePath=${'/members/password'}, member=${member ?: session.loginMember})}">
        </aside>
      </th:block>

      <!-- 본문 -->
      <main class="page-content" role="main">
        <h2>비밀번호 변경</h2>
        <hr class="line">

        <section class="form-card">
          <form th:action="@{/members/password}" method="post" th:object="${passwordForm}" novalidate>
            <!-- ✅ CSRF -->
            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" id="_csrfToken" />

            <!-- ✅ 글로벌 에러 (폼 내부로 이동) -->
            <div th:if="${#fields.hasErrors('*')}" class="error-box">
              <p th:each="err : ${#fields.errors('*')}" th:text="${err}"></p>
            </div>

            <!-- 현재 비밀번호 -->
            <div class="form-row">
              <label for="currentPassword">현재 비밀번호</label>
              <div class="input-wrap">
                <i class="fa-solid fa-lock input-icon" aria-hidden="true"></i>
                <input type="password" id="currentPassword" th:field="*{currentPassword}"
                  autocomplete="current-password" required>
                <button class="toggle-btn" type="button" aria-label="현재 비밀번호 보기 토글">
                  <i class="fa-regular fa-eye-slash"></i>
                </button>
              </div>
              <small id="currentPwMsg" class="helper"></small>
              <span th:if="${#fields.hasErrors('currentPassword')}" th:errors="*{currentPassword}" class="error"></span>
            </div>

            <!-- 새 비밀번호 -->
            <div class="form-row">
              <label for="newPassword">새 비밀번호</label>
              <div class="input-wrap">
                <i class="fa-solid fa-key input-icon" aria-hidden="true"></i>
                <input type="password" id="newPassword" th:field="*{newPassword}" placeholder="대/소문자·숫자·특수문자 포함 8~12자"
                  autocomplete="new-password" required>
                <button class="toggle-btn" type="button" aria-label="새 비밀번호 보기 토글">
                  <i class="fa-regular fa-eye-slash"></i>
                </button>
              </div>

              <!-- 강도바 -->
              <div class="strength">
                <div class="bar"></div>
                <div class="bar"></div>
                <div class="bar"></div>
                <div class="bar"></div>
              </div>

              <!-- 조건 체크리스트 -->
              <ul class="criteria-list" aria-live="polite">
                <li id="c-length">8~12자</li>
                <li id="c-upper">영문 대문자 포함</li>
                <li id="c-lower">영문 소문자 포함</li>
                <li id="c-digit">숫자 포함</li>
                <li id="c-special">특수문자 포함</li>
                <li id="c-space">공백 없음</li>
              </ul>

              <span th:if="${#fields.hasErrors('newPassword')}" th:errors="*{newPassword}" class="error"></span>
            </div>

            <!-- 새 비밀번호 확인 -->
            <div class="form-row">
              <label for="confirmPassword">새 비밀번호 확인</label>
              <div class="input-wrap">
                <i class="fa-solid fa-check input-icon" aria-hidden="true"></i>
                <input type="password" id="confirmPassword" th:field="*{confirmPassword}" autocomplete="new-password"
                  required>
                <button class="toggle-btn" type="button" aria-label="새 비밀번호 확인 보기 토글">
                  <i class="fa-regular fa-eye-slash"></i>
                </button>
              </div>
              <small id="matchMsg" class="helper"></small>
              <span th:if="${#fields.hasErrors('confirmPassword')}" th:errors="*{confirmPassword}" class="error"></span>
            </div>

            <div class="form-button-group">
              <button id="submitBtn" type="submit" class="btn btn-primary" disabled>변경</button>
              <a th:href="@{/mypage}" class="btn btn-secondary">취소</a>
            </div>
          </form>
        </section>
      </main>
    </div>

    <footer th:replace="~{fragments/footer :: footer}"></footer>
  </div>

<!------------------------------------------------------------------------------------------------------->
<!---------------------------------------------script---------------------------------------------------->
<!------------------------------------------------------------------------------------------------------->
  <script defer th:src="@{/js/member/passwordForm.js}"></script>
  <script th:src="@{/js/layout.js}"></script>
</body>

</html>