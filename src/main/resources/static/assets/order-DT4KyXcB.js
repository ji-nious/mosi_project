import{r as p,j as e,R,a as E}from"./client-DJIKB08a.js";const x=async a=>{if(a.status===401)return window.location.href="/login",null;try{return await a.json()}catch(s){throw console.error("JSON íŒŒì‹± ì˜¤ë¥˜:",s),new Error("ì„œë²„ ì‘ë‹µì„ ì²˜ë¦¬í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤")}},N=(a,s)=>{throw console.error(`${s} ì‹¤íŒ¨:`,a),a},v={async getOrderInfo(){try{const a=await fetch("/order/info",{method:"GET",headers:{"Content-Type":"application/json"}});return await x(a)}catch(a){N(a,"ì£¼ë¬¸ ì •ë³´ ì¡°íšŒ")}},async createOrder(a){try{const s=await fetch("/order/create",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});return await x(s)}catch(s){N(s,"ì£¼ë¬¸ ìƒì„±")}},async processPayment(a){try{const s=await fetch("/order/payment",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});return await x(s)}catch(s){N(s,"ê²°ì œ ì²˜ë¦¬")}},async getOrderDetail(a){try{const s=await fetch(`/order/${a}`,{method:"GET",headers:{"Content-Type":"application/json"}});return await x(s)}catch(s){N(s,"ì£¼ë¬¸ ìƒì„¸ ì¡°íšŒ")}},async cancelOrder(a,s){try{const c=await fetch(`/order/${a}/cancel`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({reason:s})});return await x(c)}catch(c){N(c,"ì£¼ë¬¸ ì·¨ì†Œ")}}};function b({label:a,placeholder:s,value:c,onChange:n,type:d="text",required:o=!1,disabled:i=!1}){return e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:a}),e.jsx("input",{type:d,placeholder:s,value:c,onChange:t=>n(t.target.value),required:o,disabled:i,className:"form-input"})]})}function S({name:a,value:s,checked:c,onChange:n,children:d,description:o}){return e.jsxs("div",{className:`payment-option ${c?"selected":""}`,onClick:()=>n(s),children:[e.jsx("input",{type:"radio",name:a,value:s,checked:c,onChange:()=>n(s),className:"payment-radio"}),e.jsxs("div",{className:"payment-content",children:[e.jsx("div",{className:"payment-label",children:d}),o&&e.jsx("div",{className:"payment-description",children:o})]})]})}function D({productName:a,price:s,quantity:c,seller:n,productImage:d,description:o}){return e.jsxs("div",{className:"order-item",children:[e.jsx("div",{className:"order-item-image",children:d?e.jsx("img",{src:d,alt:a,loading:"lazy",onError:i=>{i.target&&(i.target.style.display="none",i.target.nextSibling&&(i.target.nextSibling.style.display="block"))}}):e.jsx("div",{className:"no-image",children:"ì´ë¯¸ì§€ ì—†ìŒ"})}),e.jsxs("div",{className:"order-item-info",children:[e.jsx("div",{className:"order-item-title",children:a}),e.jsx("div",{className:"order-item-description",children:o||"ìƒì„¸ì„¤ëª…ìž…ë‹ˆë‹¤."}),e.jsxs("div",{className:"order-item-meta",children:["ê²½ë¹„ â€¢ ì˜ˆì•½ â€¢ ",n]})]}),e.jsxs("div",{className:"order-item-quantity",children:["ìˆ˜ëŸ‰: ",c,"ê°œ"]}),e.jsxs("div",{className:"order-item-price",children:[(s*c).toLocaleString(),"ì›"]})]})}function $({orderItems:a=[],memberInfo:s={},onSubmit:c}){const[n,d]=p.useState({ordererName:s.name||"",phone:s.phone||"",email:s.email||"",requirements:"",paymentMethod:"card"}),o=(t,h)=>{d(f=>({...f,[t]:h}))},i=t=>{if(t.preventDefault(),!n.ordererName||!n.phone||!n.email){alert("í•„ìˆ˜ ì •ë³´ë¥¼ ëª¨ë‘ ìž…ë ¥í•´ì£¼ì„¸ìš”.");return}if(!n.paymentMethod){alert("ê²°ì œìˆ˜ë‹¨ì„ ì„ íƒí•´ì£¼ì„¸ìš”.");return}c({...n,items:a})};return e.jsxs("form",{onSubmit:i,className:"order-form",children:[e.jsxs("div",{className:"form-section",children:[e.jsxs("div",{className:"section-title",children:[e.jsx("i",{className:"fas fa-user section-icon"}),"ì£¼ë¬¸ìž ì •ë³´"]}),e.jsx(b,{label:"ì£¼ë¬¸ìžëª…",placeholder:"ì£¼ë¬¸ìžëª… ìž…ë ¥ (ìˆ˜ì •ë¶ˆê°€)",value:n.ordererName,onChange:t=>o("ordererName",t),disabled:!!s.name}),e.jsx(b,{label:"ì—°ë½ì²˜",placeholder:"010-1234-5678(ìˆ˜ì •ë¶ˆê°€)",value:n.phone,onChange:t=>o("phone",t),disabled:!!s.phone}),e.jsx(b,{label:"ì´ë©”ì¼",type:"email",placeholder:"moomoo@noomssom.co.kr(ìˆ˜ì •ë¶ˆê°€)",value:n.email,onChange:t=>o("email",t),disabled:!!s.email}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"ìš”ì²­ì‚¬í•­"}),e.jsx("textarea",{placeholder:"ìš”ì²­ì‚¬í•­ì„ ìž…ë ¥í•´ì£¼ì„¸ìš”",value:n.requirements,onChange:t=>o("requirements",t.target.value),className:"form-textarea",rows:"3"})]})]}),e.jsxs("div",{className:"form-section",children:[e.jsxs("div",{className:"section-title",children:[e.jsx("i",{className:"fas fa-credit-card section-icon"}),"ê²°ì œìˆ˜ë‹¨"]}),e.jsxs("div",{className:"payment-options",children:[e.jsx(S,{name:"payment",value:"card",checked:n.paymentMethod==="card",onChange:t=>o("paymentMethod",t),children:"ì‹ ìš©ì¹´ë“œ / ì²´í¬ì¹´ë“œ"}),e.jsx(S,{name:"payment",value:"bank",checked:n.paymentMethod==="bank",onChange:t=>o("paymentMethod",t),children:"ë¬´í†µìž¥ìž…ê¸ˆ"}),e.jsx(S,{name:"payment",value:"simple",checked:n.paymentMethod==="simple",onChange:t=>o("paymentMethod",t),children:"ê°„íŽ¸ê²°ì œ"})]})]}),e.jsxs("div",{className:"form-section",children:[e.jsxs("div",{className:"section-title",children:[e.jsx("i",{className:"fas fa-shopping-bag section-icon"}),"ì£¼ë¬¸ìƒí’ˆ(",a.length,"ê°œ)"]}),a.length>0?a.map((t,h)=>e.jsx(D,{productName:t.productName,price:t.price,quantity:t.quantity,seller:t.seller||"íŒë§¤ìž",productImage:t.productImage,description:t.description},h)):e.jsxs("div",{className:"no-items",children:[e.jsx("p",{children:"ì£¼ë¬¸í•  ìƒí’ˆì´ ì—†ìŠµë‹ˆë‹¤."}),e.jsx("a",{href:"/cart",className:"go-cart-btn",children:"ìž¥ë°”êµ¬ë‹ˆë¡œ ì´ë™"})]})]})]})}function A({items:a=[],onPaymentMethodSelect:s,paymentMethod:c="card",onPayment:n}){const d=a.length,o=a.reduce((i,t)=>i+t.price*t.quantity,0);return e.jsxs("div",{className:"payment-summary",children:[e.jsx("div",{className:"payment-title",children:"ê²°ì œì •ë³´"}),e.jsxs("div",{className:"order-summary-section",children:[e.jsxs("div",{className:"summary-header",children:[e.jsx("span",{children:"ì£¼ë¬¸ìƒí’ˆ"}),e.jsxs("span",{children:[d,"ê°œ"]})]}),e.jsx("div",{className:"items-summary",children:a.map((i,t)=>e.jsxs("div",{className:"summary-item",children:[e.jsx("span",{className:"item-name",children:i.productName}),e.jsxs("span",{className:"item-quantity",children:["Ã—",i.quantity]}),e.jsxs("span",{className:"item-price",children:[(i.price*i.quantity).toLocaleString(),"ì›"]})]},t))})]}),e.jsx("div",{className:"payment-details",children:e.jsxs("div",{className:"payment-row",children:[e.jsx("span",{children:"ìƒí’ˆ ê¸ˆì•¡"}),e.jsxs("span",{children:[o?.toLocaleString(),"ì›"]})]})}),e.jsxs("div",{className:"payment-method-section",children:[e.jsx("div",{className:"payment-method-title",children:"ê²°ì œìˆ˜ë‹¨"}),e.jsxs("div",{className:"payment-methods",children:[e.jsxs("label",{className:"payment-method-item",children:[e.jsx("input",{type:"radio",name:"paymentMethod",value:"card",checked:c==="card",onChange:()=>s("card")}),e.jsx("span",{children:"ðŸ’³ ì‹ ìš©ì¹´ë“œ / ì²´í¬ì¹´ë“œ"})]}),e.jsxs("label",{className:"payment-method-item",children:[e.jsx("input",{type:"radio",name:"paymentMethod",value:"bank",checked:c==="bank",onChange:()=>s("bank")}),e.jsx("span",{children:"ðŸ¦ ë¬´í†µìž¥ìž…ê¸ˆ"})]}),e.jsxs("label",{className:"payment-method-item",children:[e.jsx("input",{type:"radio",name:"paymentMethod",value:"simple",checked:c==="simple",onChange:()=>s("simple")}),e.jsx("span",{children:"ðŸ’³ ê°„íŽ¸ê²°ì œ"})]})]})]}),e.jsxs("div",{className:"payment-total",children:[e.jsx("span",{className:"payment-total-label",children:"ì´ ìƒí’ˆ ê¸ˆì•¡"}),e.jsxs("span",{className:"payment-total-price",children:[o?.toLocaleString(),"ì›"]})]}),e.jsxs("button",{onClick:n,className:"payment-button",disabled:!a.length,children:[o?.toLocaleString(),"ì› ê²°ì œí•˜ê¸°"]})]})}function J({message:a,onRetry:s}){return e.jsxs("div",{className:"error-container",children:[e.jsx("div",{className:"error-icon",children:e.jsx("i",{className:"fas fa-exclamation-triangle"})}),e.jsx("h2",{children:"ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤"}),e.jsx("p",{children:a}),e.jsx("button",{onClick:s,className:"payment-button",children:"ë‹¤ì‹œ ì‹œë„"})]})}function L(){const[a,s]=p.useState(null),[c,n]=p.useState({}),[d,o]=p.useState(null),[i,t]=p.useState(!1),[h,f]=p.useState("card"),[O,j]=p.useState(!1),u=a?.orderItems||[],w=u.reduce((r,l)=>r+l.price*l.quantity,0);p.useEffect(()=>{C()},[]);const C=async()=>{try{o(null);const r=sessionStorage.getItem("selectedCartItems");if(!r){alert("ì£¼ë¬¸í•  ìƒí’ˆì„ ì„ íƒí•´ì£¼ì„¸ìš”."),window.location.href="/cart";return}const l=JSON.parse(r),m={name:"í™ê¸¸ë™",phone:"010-1234-5678",email:"hong@example.com"};s({items:l}),n(m)}catch(r){console.error("ì£¼ë¬¸ ë°ì´í„° ì¡°íšŒ ì‹¤íŒ¨:",r),o("ì£¼ë¬¸ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤")}},k=async r=>{try{t(!0);const l=await v.createOrder({...r,totalAmount:g(r.items)});l&&l.success?await P(l.orderId,r.paymentMethod):alert(l?.message||"ì£¼ë¬¸ ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤")}catch(l){console.error("ì£¼ë¬¸ ìƒì„± ì‹¤íŒ¨:",l),alert("ì£¼ë¬¸ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤")}finally{t(!1)}},P=async(r,l)=>{try{t(!0);const m=g(a.items),y=await v.processPayment({orderId:r,paymentMethod:l,amount:m});y&&y.success?(alert("ê²°ì œê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!"),sessionStorage.removeItem("selectedCartItems"),window.location.href=`/order/complete/${r}`):alert(y?.message||"ê²°ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤")}catch(m){console.error("ê²°ì œ ì²˜ë¦¬ ì‹¤íŒ¨:",m),alert("ê²°ì œ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤")}finally{t(!1)}},g=r=>r.reduce((l,m)=>l+m.price*m.quantity,0),I=r=>{f(r)},M=async()=>{try{j(!0),t(!0);const r=await fetch("/order/payment",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({paymentMethod:h,totalAmount:w})});if(r.ok){const l=await r.json();alert("ê²°ì œê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!"),window.location.href=`/order/complete?orderCode=${l.orderCode}`}else alert("ê²°ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤")}catch(r){console.error("ê²°ì œ ì²˜ë¦¬ ì‹¤íŒ¨:",r),alert("ê²°ì œ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤")}finally{j(!1),t(!1)}},T=async r=>{f(r),j(!0);try{t(!0);const l={cartItemIds:u.map(q=>q.productId),ordererName:c.name,phone:c.phone,email:c.email,requirements:"",paymentMethod:r,totalAmount:g(u)},m=await v.createOrder(l),y=await v.processPayment({orderId:m.orderId,paymentMethod:r,amount:g(u)});y&&y.success?setTimeout(()=>{j(!1),sessionStorage.removeItem("selectedCartItems"),window.location.href=`/order/complete?orderCode=${m.orderCode}`},1e3):(j(!1),alert(y?.message||"ê²°ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤"))}catch(l){console.error("ê²°ì œ ì²˜ë¦¬ ì‹¤íŒ¨:",l),j(!1),alert("ê²°ì œ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤")}finally{t(!1)}};return d?e.jsx("div",{className:"order-container",children:e.jsx(J,{message:d,onRetry:C})}):a?e.jsxs("div",{className:"order-container",children:[e.jsxs("div",{className:"breadcrumb",children:[e.jsx("a",{href:"/cart",children:"ìž¥ë°”êµ¬ë‹ˆ"})," >",e.jsx("span",{className:"current",children:" ì£¼ë¬¸ê²°ì œ"})," >",e.jsx("span",{children:" ì£¼ë¬¸ì™„ë£Œ"})]}),e.jsx("h1",{className:"page-title",children:"ì£¼ë¬¸ê²°ì œ"}),e.jsxs("div",{className:"order-layout",children:[e.jsx("div",{className:"order-content",children:e.jsx($,{orderItems:u,memberInfo:c,onSubmit:k,loading:i,onPaymentMethodChange:I})}),e.jsx("div",{className:"order-sidebar",children:e.jsx(A,{items:u,onPaymentMethodSelect:T,paymentMethod:h,onPayment:M})})]}),e.jsx("div",{className:"order-bottom",children:e.jsxs("button",{onClick:M,className:"full-payment-button",disabled:!u.length,children:[w?.toLocaleString(),"ì› ê²°ì œí•˜ê¸°"]})}),O&&e.jsx("div",{className:"payment-modal-overlay",children:e.jsxs("div",{className:"payment-modal",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("h3",{children:"ê²°ì œ ì§„í–‰ ì¤‘..."}),e.jsxs("p",{children:[h==="card"?"ì‹ ìš©ì¹´ë“œ":h==="bank"?"ë¬´í†µìž¥ìž…ê¸ˆ":h==="simple"?"ê°„íŽ¸ê²°ì œ":"ê²°ì œ"," ê²°ì œë¥¼ ì²˜ë¦¬í•˜ê³  ìžˆìŠµë‹ˆë‹¤"]})]})})]}):e.jsxs("div",{className:"order-container",children:[e.jsxs("div",{className:"breadcrumb",children:[e.jsx("a",{href:"/cart",children:"ìž¥ë°”êµ¬ë‹ˆ"})," >",e.jsx("span",{className:"current",children:" ì£¼ë¬¸ê²°ì œ"})," >",e.jsx("span",{children:" ì£¼ë¬¸ì™„ë£Œ"})]}),e.jsx("h1",{className:"page-title",children:"ì£¼ë¬¸ê²°ì œ"}),e.jsx("p",{children:"ì£¼ë¬¸ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘..."})]})}R.createRoot(document.getElementById("order-root")).render(e.jsx(E.StrictMode,{children:e.jsx(L,{})}));
