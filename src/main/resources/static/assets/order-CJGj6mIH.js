import{r as p,j as e,R,a as q}from"./client-DJIKB08a.js";const x=async s=>{if(s.status===401)return window.location.href="/login",null;try{return await s.json()}catch(a){throw console.error("JSON 파싱 오류:",a),new Error("서버 응답을 처리할 수 없습니다")}},y=(s,a)=>{throw console.error(`${a} 실패:`,s),s},T={async getOrderInfo(){try{const s=await fetch("/order/info",{method:"GET",headers:{"Content-Type":"application/json"}});return await x(s)}catch(s){y(s,"주문 정보 조회")}},async createOrder(s){try{const a=await fetch("/order/create",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});return await x(a)}catch(a){y(a,"주문 생성")}},async processPayment(s){try{const a=await fetch("/order/payment",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});return await x(a)}catch(a){y(a,"결제 처리")}},async getOrderDetail(s){try{const a=await fetch(`/order/${s}`,{method:"GET",headers:{"Content-Type":"application/json"}});return await x(a)}catch(a){y(a,"주문 상세 조회")}},async cancelOrder(s,a){try{const o=await fetch(`/order/${s}/cancel`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({reason:a})});return await x(o)}catch(o){y(o,"주문 취소")}}};function v({label:s,placeholder:a,value:o,onChange:i,type:c="text",required:r=!1,disabled:m=!1}){return e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:s}),e.jsx("input",{type:c,placeholder:a,value:o,onChange:d=>i(d.target.value),required:r,disabled:m,className:"form-input"})]})}function b({name:s,value:a,checked:o,onChange:i,children:c,description:r}){return e.jsxs("div",{className:`payment-option ${o?"selected":""}`,onClick:()=>i(a),children:[e.jsx("input",{type:"radio",name:s,value:a,checked:o,onChange:()=>i(a),className:"payment-radio"}),e.jsxs("div",{className:"payment-content",children:[e.jsx("div",{className:"payment-label",children:c}),r&&e.jsx("div",{className:"payment-description",children:r})]})]})}function I({productName:s,price:a,quantity:o,optionType:i,sellerNickname:c,productImage:r}){return e.jsxs("div",{className:"order-item",children:[e.jsx("div",{className:"order-item-image",children:r?e.jsx("img",{src:r,alt:s,loading:"lazy",onError:m=>{m.target&&(m.target.style.display="none",m.target.nextSibling&&(m.target.nextSibling.style.display="block"))}}):e.jsx("div",{className:"no-image",children:"이미지 없음"})}),e.jsxs("div",{className:"order-item-info",children:[e.jsx("div",{className:"order-item-title",children:s}),e.jsxs("div",{className:"order-item-option",children:["옵션: (",i,")"]}),e.jsxs("div",{className:"order-item-seller",children:["판매자: ",c||"판매자"]})]}),e.jsxs("div",{className:"order-item-quantity",children:["수량: ",o,"개"]}),e.jsxs("div",{className:"order-item-price",children:[(a*o).toLocaleString(),"원"]})]})}function D({orderItems:s=[],memberInfo:a={},onSubmit:o,paymentMethod:i,onPaymentMethodChange:c}){const[r,m]=p.useState({ordererName:a.name||"",phone:a.phone||"",email:a.email||"",requirements:""}),d=(n,j)=>{m(N=>({...N,[n]:j}))},u=n=>{if(n.preventDefault(),!r.ordererName||!r.phone||!r.email){alert("필수 정보를 모두 입력해주세요.");return}if(!i){alert("결제수단을 선택해주세요.");return}o({...r,items:s})};return e.jsxs("form",{onSubmit:u,className:"order-form",children:[e.jsxs("div",{className:"form-section",children:[e.jsxs("div",{className:"section-title",children:[e.jsx("i",{className:"fas fa-user section-icon"}),"주문자 정보"]}),e.jsxs("div",{className:"form-info-notice",children:[e.jsx("i",{className:"fas fa-info-circle"}),"회원 정보가 자동으로 입력되었습니다. 필요시 수정 가능합니다."]}),e.jsx(v,{label:"주문자명",placeholder:"이름을 입력해주세요",value:r.ordererName,onChange:n=>d("ordererName",n),disabled:!!a.name}),e.jsx(v,{label:"연락처",placeholder:"휴대폰 번호를 입력해주세요",value:r.phone,onChange:n=>d("phone",n),disabled:!!a.phone}),e.jsx(v,{label:"이메일",type:"email",placeholder:"이메일 주소를 입력해주세요",value:r.email,onChange:n=>d("email",n),disabled:!!a.email}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"배송 요청사항 (선택)"}),e.jsx("textarea",{placeholder:"배송 시 특별히 요청하실 사항이 있으시면 입력해주세요 (예: 부재 시 경비실 보관)",value:r.requirements,onChange:n=>d("requirements",n.target.value),className:"form-textarea",rows:"2"})]})]}),e.jsxs("div",{className:"form-section",children:[e.jsxs("div",{className:"section-title",children:[e.jsx("i",{className:"fas fa-credit-card section-icon"}),"결제수단"]}),e.jsxs("div",{className:"payment-options",children:[e.jsx(b,{name:"payment",value:"card",checked:i==="card",onChange:c,children:"신용카드 / 체크카드"}),e.jsx(b,{name:"payment",value:"bank",checked:i==="bank",onChange:c,children:"무통장입금"}),e.jsx(b,{name:"payment",value:"simple",checked:i==="simple",onChange:c,children:"간편결제"})]})]}),e.jsxs("div",{className:"form-section",children:[e.jsxs("div",{className:"section-title",children:[e.jsx("i",{className:"fas fa-shopping-bag section-icon"}),"주문상품(",s.length,"개)"]}),s.length>0?s.map((n,j)=>e.jsx(I,{productName:n.productName,price:n.price,quantity:n.quantity,optionType:n.optionType,sellerNickname:n.sellerNickname,productImage:n.productImage},j)):e.jsxs("div",{className:"no-items",children:[e.jsx("p",{children:"주문할 상품이 없습니다."}),e.jsx("a",{href:"/cart",className:"go-cart-btn",children:"장바구니로 이동"})]})]})]})}function M({items:s=[],onPayment:a}){const o=s.length,i=s.reduce((c,r)=>c+r.price*r.quantity,0);return e.jsxs("div",{className:"payment-summary",children:[e.jsx("div",{className:"payment-title",children:"결제정보"}),e.jsxs("div",{className:"order-summary-section",children:[e.jsxs("div",{className:"summary-header",children:[e.jsx("span",{children:"주문상품"}),e.jsxs("span",{children:[o,"개"]})]}),e.jsx("div",{className:"items-summary",children:s.map((c,r)=>e.jsxs("div",{className:"summary-item",children:[e.jsx("span",{className:"item-name",children:c.productName}),e.jsxs("span",{className:"item-price",children:[(c.price*c.quantity).toLocaleString(),"원"]})]},r))})]}),e.jsxs("div",{className:"payment-total",children:[e.jsx("span",{className:"payment-total-label",children:"총 상품 금액"}),e.jsxs("span",{className:"payment-total-price",children:[i?.toLocaleString(),"원"]})]}),e.jsxs("button",{onClick:a,className:"payment-button",disabled:!s.length,children:[i?.toLocaleString(),"원 결제하기"]})]})}function J({message:s,onRetry:a}){return e.jsxs("div",{className:"error-container",children:[e.jsx("div",{className:"error-icon",children:e.jsx("i",{className:"fas fa-exclamation-triangle"})}),e.jsx("h2",{children:"오류가 발생했습니다"}),e.jsx("p",{children:s}),e.jsx("button",{onClick:a,className:"payment-button",children:"다시 시도"})]})}function $(){const[s,a]=p.useState(null),[o,i]=p.useState({}),[c,r]=p.useState(null),[m,d]=p.useState(!1),[u,n]=p.useState("card"),[j,N]=p.useState(!1),f=s?.orderItems||[],S=f.reduce((t,l)=>t+l.price*l.quantity,0);p.useEffect(()=>{w()},[]);const w=async()=>{try{r(null);const t=sessionStorage.getItem("selectedCartItems");if(console.log("세션 스토리지 데이터:",t),!t){alert("주문할 상품을 선택해주세요."),window.location.href="/cart";return}const l=JSON.parse(t);console.log("파싱된 상품 데이터:",l);const h={name:"홍길동",phone:"010-1234-5678",email:"hong@example.com"};a({orderItems:l}),i(h)}catch(t){console.error("주문 데이터 조회 실패:",t),r("주문 정보를 불러올 수 없습니다")}},P=async t=>{try{d(!0);const l=await T.createOrder({...t,totalAmount:C(t.items)});l&&l.success?await k(l.orderId,t.paymentMethod):alert(l?.message||"주문 생성에 실패했습니다")}catch(l){console.error("주문 생성 실패:",l),alert("주문 처리 중 오류가 발생했습니다")}finally{d(!1)}},k=async(t,l)=>{try{d(!0);const h=C(s.items),g=await T.processPayment({orderId:t,paymentMethod:l,amount:h});g&&g.success?(alert("결제가 완료되었습니다!"),sessionStorage.removeItem("selectedCartItems"),window.location.href=`/order/complete/${t}`):alert(g?.message||"결제에 실패했습니다")}catch(h){console.error("결제 처리 실패:",h),alert("결제 처리 중 오류가 발생했습니다")}finally{d(!1)}},C=t=>t.reduce((l,h)=>l+h.price*h.quantity,0),E=t=>{n(t)},O=async()=>{try{N(!0),d(!0);const t=await fetch("/order/payment",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({paymentMethod:u,totalAmount:S})});if(t.ok){const l=await t.json();alert("결제가 완료되었습니다!"),window.location.href=`/order/complete?orderCode=${l.orderCode}`}else alert("결제에 실패했습니다")}catch(t){console.error("결제 처리 실패:",t),alert("결제 처리 중 오류가 발생했습니다")}finally{N(!1),d(!1)}};return c?e.jsx("div",{className:"order-container",children:e.jsx(J,{message:c,onRetry:w})}):s?e.jsxs("div",{className:"order-container",children:[e.jsxs("div",{className:"breadcrumb",children:[e.jsx("a",{href:"/cart",children:"장바구니"})," >",e.jsx("span",{className:"current",children:" 주문결제"})," >",e.jsx("span",{children:" 주문완료"})]}),e.jsx("h1",{className:"page-title",children:"주문결제"}),e.jsxs("div",{className:"order-layout",children:[e.jsx("div",{className:"order-content",children:e.jsx(D,{orderItems:f,memberInfo:o,onSubmit:P,loading:m,onPaymentMethodChange:E,paymentMethod:u})}),e.jsx("div",{className:"order-sidebar",children:e.jsx(M,{items:f,onPayment:O})})]}),e.jsx("div",{className:"order-bottom",children:e.jsxs("button",{onClick:O,className:"full-payment-button",disabled:!f.length,children:[S?.toLocaleString(),"원 결제하기"]})}),j&&e.jsx("div",{className:"payment-modal-overlay",children:e.jsxs("div",{className:"payment-modal",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("h3",{children:"결제 진행 중..."}),e.jsxs("p",{children:[u==="card"?"신용카드":u==="bank"?"무통장입금":u==="simple"?"간편결제":"결제"," 결제를 처리하고 있습니다"]})]})})]}):e.jsxs("div",{className:"order-container",children:[e.jsxs("div",{className:"breadcrumb",children:[e.jsx("a",{href:"/cart",children:"장바구니"})," >",e.jsx("span",{className:"current",children:" 주문결제"})," >",e.jsx("span",{children:" 주문완료"})]}),e.jsx("h1",{className:"page-title",children:"주문결제"}),e.jsx("p",{children:"주문 정보를 불러오는 중..."})]})}R.createRoot(document.getElementById("order-root")).render(e.jsx(q.StrictMode,{children:e.jsx($,{})}));
