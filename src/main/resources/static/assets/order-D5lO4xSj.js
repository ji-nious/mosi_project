import{r as p,j as e,R as J,a as L}from"./client-D_PkVYew.js";import"./modulepreload-polyfill-B5Qt9EMX.js";const f=async a=>{if(a.status===401)return window.location.href="/login",null;try{const s=await a.json();if(s.header&&s.header.rtcd!=="S00")throw new Error(s.header.rtmsg||"요청 처리 중 오류가 발생했습니다");return s.body||s}catch(s){throw s.message!=="서버 응답을 처리할 수 없습니다"?s:(console.error("JSON 파싱 오류:",s),new Error("서버 응답을 처리할 수 없습니다"))}},N=(a,s)=>{throw console.error(`${s} 실패:`,a),a},O={async getOrderInfo(){try{const a=await fetch("/order/info",{method:"GET",headers:{"Content-Type":"application/json"}});return await f(a)}catch(a){N(a,"주문 정보 조회")}},async createOrder(a){try{const s=await fetch("/order/create",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});return await f(s)}catch(s){N(s,"주문 생성")}},async processPayment(a){try{const s=await fetch("/order/payment",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});return await f(s)}catch(s){N(s,"결제 처리")}},async getOrderDetail(a){try{const s=await fetch(`/order/${a}`,{method:"GET",headers:{"Content-Type":"application/json"}});return await f(s)}catch(s){N(s,"주문 상세 조회")}},async cancelOrder(a,s){try{const t=await fetch(`/order/${a}/cancel`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({reason:s})});return await f(t)}catch(t){N(t,"주문 취소")}}};function b({label:a,placeholder:s,value:t,onChange:i,type:m="text",required:l=!1,disabled:u=!1}){return e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:a}),e.jsx("input",{type:m,placeholder:s,value:t,onChange:d=>i(d.target.value),required:l,disabled:u,className:"form-input"})]})}function S({name:a,value:s,checked:t,onChange:i,children:m}){return e.jsxs("div",{className:`payment-option ${t?"selected":""}`,onClick:()=>i(s),children:[e.jsx("input",{type:"radio",name:a,value:s,checked:t,onChange:()=>i(s),className:"payment-radio"}),e.jsx("div",{className:"payment-content",children:e.jsx("div",{className:"payment-label",children:m})})]})}function A({productName:a,price:s,quantity:t,optionType:i,sellerNickname:m,productImage:l,originalPrice:u}){return e.jsxs("div",{className:"order-item",children:[e.jsx("div",{className:"order-item-image",children:l?e.jsx("img",{src:l,alt:a,loading:"lazy"}):e.jsx("div",{className:"no-image",children:"이미지 없음"})}),e.jsxs("div",{className:"order-item-info",children:[e.jsx("div",{className:"order-item-title",children:a}),e.jsxs("div",{className:"order-item-option",children:["옵션: (",i,")"]}),e.jsxs("div",{className:"order-item-seller",children:["판매자: ",m||"판매자"]})]}),e.jsxs("div",{className:"order-item-price",children:[u&&u!==s&&e.jsxs("span",{className:"original-price",children:[(u*t).toLocaleString(),"원"]}),e.jsxs("span",{className:"sale-price",children:[(s*t).toLocaleString(),"원"]})]})]})}function G({orderItems:a=[],memberInfo:s={},onSubmit:t,paymentMethod:i,onPaymentMethodChange:m}){const[l,u]=p.useState({ordererName:s.name||"",phone:s.phone||"",email:s.email||"",requirements:""}),d=(r,g)=>{u(w=>({...w,[r]:g}))},y=r=>{if(r.preventDefault(),!l.ordererName||!l.phone||!l.email){alert("필수 정보를 모두 입력해주세요.");return}if(!i){alert("결제수단을 선택해주세요.");return}t({...l,items:a})};return e.jsxs("form",{onSubmit:y,className:"order-form",children:[e.jsxs("div",{className:"form-section",children:[e.jsxs("div",{className:"section-title",children:[e.jsx("i",{className:"fas fa-user section-icon"}),"주문자 정보"]}),e.jsx(b,{label:"주문자명",placeholder:"이름을 입력해주세요",value:l.ordererName,onChange:r=>d("ordererName",r),disabled:!!s.name}),e.jsx(b,{label:"연락처",placeholder:"휴대폰 번호를 입력해주세요",value:l.phone,onChange:r=>d("phone",r),disabled:!!s.phone}),e.jsx(b,{label:"이메일",type:"email",placeholder:"이메일 주소를 입력해주세요",value:l.email,onChange:r=>d("email",r),disabled:!!s.email}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"요청사항(50자 이내)"}),e.jsx("textarea",{placeholder:"요구사항을 입력해주세요",value:l.requirements,onChange:r=>d("requirements",r.target.value),className:"form-textarea",rows:"2",maxLength:50}),e.jsxs("div",{className:"character-counter",children:[e.jsxs("span",{className:l.requirements.length>50?"error":"",children:[l.requirements.length,"/50자"]}),l.requirements.length>50&&e.jsx("span",{className:"error-message",children:"50자를 초과했습니다."})]})]})]}),e.jsxs("div",{className:"form-section",children:[e.jsxs("div",{className:"section-title",children:[e.jsx("i",{className:"fas fa-credit-card section-icon"}),"결제수단"]}),e.jsxs("div",{className:"payment-options",children:[e.jsx(S,{name:"payment",value:"card",checked:i==="card",onChange:r=>{m(r),window.processPaymentImmediately&&window.processPaymentImmediately(r)},children:"신용카드 / 체크카드"}),e.jsx(S,{name:"payment",value:"bank",checked:i==="bank",onChange:r=>{m(r),window.processPaymentImmediately&&window.processPaymentImmediately(r)},children:"무통장입금"}),e.jsx(S,{name:"payment",value:"simple",checked:i==="simple",onChange:r=>{m(r),window.processPaymentImmediately&&window.processPaymentImmediately(r)},children:"간편결제"})]})]}),e.jsxs("div",{className:"form-section",children:[e.jsxs("div",{className:"section-title",children:[e.jsx("i",{className:"fas fa-shopping-bag section-icon"}),"주문상품(",a.length,"개)"]}),a.length>0?a.map((r,g)=>e.jsx(A,{productName:r.productName,price:r.price,quantity:r.quantity,optionType:r.optionType,sellerNickname:r.sellerNickname,productImage:r.productImage,originalPrice:r.originalPrice},g)):e.jsxs("div",{className:"no-items",children:[e.jsx("p",{children:"주문할 상품이 없습니다."}),e.jsx("a",{href:"/cart",className:"go-cart-btn",children:"장바구니로 이동"})]})]})]})}function B({items:a=[]}){a.length;const s=a.reduce((t,i)=>t+i.price*i.quantity,0);return e.jsxs("div",{className:"payment-summary",children:[e.jsx("div",{className:"payment-title",children:"결제정보"}),e.jsxs("div",{className:"order-summary-section",children:[e.jsx("div",{className:"summary-header",children:e.jsx("span",{children:"주문상품"})}),e.jsx("div",{className:"items-summary",children:a.map((t,i)=>e.jsxs("div",{className:"summary-item",children:[e.jsx("span",{className:"item-name",children:t.productName}),e.jsxs("span",{className:"item-price",children:[(t.price*t.quantity).toLocaleString(),"원"]})]},i))})]}),e.jsxs("div",{className:"payment-total",children:[e.jsx("span",{className:"payment-total-label",children:"총 결제 금액"}),e.jsxs("span",{className:"payment-total-price",children:[s?.toLocaleString(),"원"]})]})]})}function F({message:a,onRetry:s}){return e.jsxs("div",{className:"error-container",children:[e.jsx("div",{className:"error-icon",children:e.jsx("i",{className:"fas fa-exclamation-triangle"})}),e.jsx("h2",{children:"오류가 발생했습니다"}),e.jsx("p",{children:a}),e.jsx("button",{onClick:s,className:"payment-button",children:"다시 시도"})]})}function z(){const[a,s]=p.useState(null),[t,i]=p.useState({}),[m,l]=p.useState(null),[u,d]=p.useState(!1),[y,r]=p.useState(""),[g,w]=p.useState(!1),[T,v]=p.useState(!1),[k,q]=p.useState(!1),x=a?.orderItems||[],C=x.reduce((o,n)=>o+n.price*n.quantity,0);p.useEffect(()=>(P(),window.processPaymentImmediately=D,v(!0),()=>{delete window.processPaymentImmediately}),[]);const P=async()=>{try{l(null);const o=sessionStorage.getItem("selectedCartItems");if(!o){alert("주문할 상품을 선택해주세요."),window.location.href="/cart";return}const n=JSON.parse(o);try{const c=await fetch("/order/member-info",{method:"GET",credentials:"include"});if(c.ok){const h=await c.json(),j=h.body||h;i({name:j.name||"",phone:j.tel||"",email:j.email||""})}else i({name:"",phone:"",email:""})}catch{i({name:"",phone:"",email:""})}s({orderItems:n})}catch{l("주문 정보를 불러올 수 없습니다")}},M=async o=>{try{d(!0);const n=await O.createOrder({...o,totalAmount:I(o.items)});n&&n.success?await R(n.orderId,o.paymentMethod):alert(n?.message||"주문 생성에 실패했습니다")}catch(n){console.error("주문 생성 실패:",n),alert("주문 처리 중 오류가 발생했습니다")}finally{d(!1)}},R=async(o,n)=>{try{d(!0);const c=I(a.items),h=await O.processPayment({orderId:o,paymentMethod:n,amount:c});h&&h.success?(alert("결제가 완료되었습니다!"),sessionStorage.removeItem("selectedCartItems"),window.location.href=`/order/complete/${o}`):alert(h?.message||"결제에 실패했습니다")}catch(c){console.error("결제 처리 실패:",c),alert("결제 처리 중 오류가 발생했습니다")}finally{d(!1)}},I=o=>o.reduce((n,c)=>n+c.price*c.quantity,0),E=o=>{r(o)},D=async o=>{try{w(!0),d(!0),await new Promise(n=>setTimeout(n,1500)),alert("결제가 완료되었습니다.")}catch(n){console.error("임시 결제 처리 실패:",n),alert("임시 결제 처리 중 오류가 발생했습니다")}finally{w(!1),d(!1)}},$=async()=>{if(!y){alert("결제 수단을 먼저 선택해주세요.");return}try{d(!0);const o={cartItemIds:x.map(c=>c.cartItemId),ordererName:t.name||"",phone:t.phone||"",email:t.email||"",requirements:t.requirements||"",paymentMethod:y,totalAmount:C},n=await fetch("/order/create",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)});if(n.ok){const c=await n.json();if(c.header&&c.header.rtcd!=="S00")throw new Error(c.header.rtmsg||"주문 처리 중 오류가 발생했습니다.");const h=c.body||c;q(!0),setTimeout(()=>{sessionStorage.removeItem("selectedCartItems"),window.updateCartCount&&window.updateCartCount();const j=h.orderCode||h.data?.orderCode;j?window.location.href=`/order/complete?orderCode=${j}`:(alert("주문 코드를 찾을 수 없습니다. 주문내역에서 확인해주세요."),window.location.href="/mypage/orders")},2e3)}else{const c=await n.json().catch(()=>({})),h=c.header?.rtmsg||c.message||`결제에 실패했습니다: ${n.status} ${n.statusText}`;alert(h)}}catch{alert("주문 처리 중 오류가 발생했습니다. 다시 시도해주세요.")}finally{d(!1)}};return m?e.jsx("div",{className:"order-container",children:e.jsx(F,{message:m,onRetry:P})}):a?e.jsxs("div",{className:"order-container",children:[e.jsx("div",{className:"continue-shopping-section",children:e.jsx("a",{href:"/cart",className:"continue-shopping-btn",children:"< 장바구니로 이동"})}),e.jsxs("div",{className:"order-layout",children:[e.jsx("div",{className:"order-content",children:e.jsx(G,{orderItems:x,memberInfo:t,onSubmit:M,loading:u,onPaymentMethodChange:E,paymentMethod:y})}),e.jsx("div",{className:"order-sidebar",children:e.jsx(B,{items:x})})]}),e.jsxs("div",{className:"order-notice",children:[e.jsx("div",{className:"notice-item",children:"※ 관광 상품은 예약 확정 후 취소 불가능합니다."}),e.jsx("div",{className:"notice-item",children:"※ 날씨나 현지 사정으로 인한 변경 시 사전안내 드립니다."}),e.jsx("div",{className:"notice-item",children:"※ 결제 후 예약 확정 안내를 받으실 수 있습니다."})]}),e.jsx("div",{className:"order-bottom",children:e.jsxs("button",{onClick:$,className:"full-payment-button",disabled:!x.length,children:[C?.toLocaleString(),"원 결제하기"]})}),T&&e.jsx("div",{className:"modal-overlay",onClick:()=>v(!1),children:e.jsxs("div",{className:"modal-content",onClick:o=>o.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h3",{children:"알림"}),e.jsx("button",{className:"modal-close",onClick:()=>v(!1),children:"×"})]}),e.jsx("div",{className:"modal-body",children:e.jsxs("p",{children:["회원 정보가 자동으로 입력됩니다.",e.jsx("br",{}),"(회원 정보는 마이페이지 > 회원 정보 관리에서 수정 가능합니다.)"]})}),e.jsx("div",{className:"modal-footer",children:e.jsx("button",{className:"modal-confirm-btn",onClick:()=>v(!1),children:"확인"})})]})}),k&&e.jsx("div",{className:"modal-overlay",children:e.jsx("div",{className:"loading-modal-content",children:e.jsxs("div",{className:"loading-container",children:[e.jsx("div",{className:"loading-spinner",children:e.jsx("i",{className:"fas fa-spinner fa-spin"})}),e.jsxs("div",{className:"loading-text",children:["주문이 완료되었습니다.",e.jsx("br",{}),"잠시만 기다려주세요."]})]})})})]}):e.jsxs("div",{className:"order-container",children:[e.jsx("div",{className:"continue-shopping-section",children:e.jsx("a",{href:"/cart",className:"continue-shopping-btn",children:"< 장바구니로 이동"})}),e.jsx("p",{children:"주문 정보를 불러오는 중..."})]})}J.createRoot(document.getElementById("order-root")).render(e.jsx(L.StrictMode,{children:e.jsx(z,{})}));
