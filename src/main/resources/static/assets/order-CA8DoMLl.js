import{r as p,j as e,R as J,a as L}from"./client-D_PkVYew.js";import"./modulepreload-polyfill-B5Qt9EMX.js";const f=async a=>{if(a.status===401)return window.location.href="/login",null;try{const s=await a.json();if(s.header&&s.header.rtcd!=="S00")throw new Error(s.header.rtmsg||"ìš”ì²­ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤");return s.body||s}catch(s){throw s.message!=="ì„œë²„ ì‘ë‹µì„ ì²˜ë¦¬í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤"?s:(console.error("JSON íŒŒì‹± ì˜¤ë¥˜:",s),new Error("ì„œë²„ ì‘ë‹µì„ ì²˜ë¦¬í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤"))}},N=(a,s)=>{throw console.error(`${s} ì‹¤íŒ¨:`,a),a},O={async getOrderInfo(){try{const a=await fetch("/order/info",{method:"GET",headers:{"Content-Type":"application/json"}});return await f(a)}catch(a){N(a,"ì£¼ë¬¸ ì •ë³´ ì¡°íšŒ")}},async createOrder(a){try{const s=await fetch("/order/create",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});return await f(s)}catch(s){N(s,"ì£¼ë¬¸ ìƒì„±")}},async processPayment(a){try{const s=await fetch("/order/payment",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});return await f(s)}catch(s){N(s,"ê²°ì œ ì²˜ë¦¬")}},async getOrderDetail(a){try{const s=await fetch(`/order/${a}`,{method:"GET",headers:{"Content-Type":"application/json"}});return await f(s)}catch(s){N(s,"ì£¼ë¬¸ ìƒì„¸ ì¡°íšŒ")}},async cancelOrder(a,s){try{const t=await fetch(`/order/${a}/cancel`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({reason:s})});return await f(t)}catch(t){N(t,"ì£¼ë¬¸ ì·¨ì†Œ")}}};function b({label:a,placeholder:s,value:t,onChange:l,type:m="text",required:c=!1,disabled:u=!1}){return e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:a}),e.jsx("input",{type:m,placeholder:s,value:t,onChange:d=>l(d.target.value),required:c,disabled:u,className:"form-input"})]})}function S({name:a,value:s,checked:t,onChange:l,children:m}){return e.jsxs("div",{className:`payment-option ${t?"selected":""}`,onClick:()=>l(s),children:[e.jsx("input",{type:"radio",name:a,value:s,checked:t,onChange:()=>l(s),className:"payment-radio"}),e.jsx("div",{className:"payment-content",children:e.jsx("div",{className:"payment-label",children:m})})]})}function A({productName:a,price:s,quantity:t,optionType:l,sellerNickname:m,productImage:c,originalPrice:u}){return console.log("ğŸ–¼ï¸ OrderItem ì´ë¯¸ì§€ ë°ì´í„°:",a,"â†’",c?"Base64 ìˆìŒ":"null/undefined"),e.jsxs("div",{className:"order-item",children:[e.jsxs("div",{className:"order-item-image",children:[c?e.jsx("img",{src:c,alt:a,loading:"lazy",onError:d=>{console.log("âŒ ì´ë¯¸ì§€ ë¡œë“œ ì‹¤íŒ¨:",a,"â†’",c),d.target.style.display="none",d.target.nextSibling.style.display="block"}}):e.jsx("div",{className:"no-image",children:"ì´ë¯¸ì§€ ì—†ìŒ"}),e.jsx("div",{className:"no-image",style:{display:"none"},children:"ì´ë¯¸ì§€ ì—†ìŒ"})]}),e.jsxs("div",{className:"order-item-info",children:[e.jsx("div",{className:"order-item-title",children:a}),e.jsxs("div",{className:"order-item-option",children:["ì˜µì…˜: (",l,")"]}),e.jsxs("div",{className:"order-item-seller",children:["íŒë§¤ì: ",m||"íŒë§¤ì"]})]}),e.jsxs("div",{className:"order-item-price",children:[u&&u!==s&&e.jsxs("span",{className:"original-price",children:[(u*t).toLocaleString(),"ì›"]}),e.jsxs("span",{className:"sale-price",children:[(s*t).toLocaleString(),"ì›"]})]})]})}function B({orderItems:a=[],memberInfo:s={},onSubmit:t,paymentMethod:l,onPaymentMethodChange:m}){const[c,u]=p.useState({ordererName:s.name||"",phone:s.phone||"",email:s.email||"",requirements:""}),d=(r,g)=>{u(w=>({...w,[r]:g}))},j=r=>{if(r.preventDefault(),!c.ordererName||!c.phone||!c.email){alert("í•„ìˆ˜ ì •ë³´ë¥¼ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.");return}if(!l){alert("ê²°ì œìˆ˜ë‹¨ì„ ì„ íƒí•´ì£¼ì„¸ìš”.");return}t({...c,items:a})};return e.jsxs("form",{onSubmit:j,className:"order-form",children:[e.jsxs("div",{className:"form-section",children:[e.jsxs("div",{className:"section-title",children:[e.jsx("i",{className:"fas fa-user section-icon"}),"ì£¼ë¬¸ì ì •ë³´"]}),e.jsx(b,{label:"ì£¼ë¬¸ìëª…",placeholder:"ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”",value:c.ordererName,onChange:r=>d("ordererName",r),disabled:!!s.name}),e.jsx(b,{label:"ì—°ë½ì²˜",placeholder:"íœ´ëŒ€í° ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”",value:c.phone,onChange:r=>d("phone",r),disabled:!!s.phone}),e.jsx(b,{label:"ì´ë©”ì¼",type:"email",placeholder:"ì´ë©”ì¼ ì£¼ì†Œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”",value:c.email,onChange:r=>d("email",r),disabled:!!s.email}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"ìš”ì²­ì‚¬í•­(50ì ì´ë‚´)"}),e.jsx("textarea",{placeholder:"ìš”êµ¬ì‚¬í•­ì„ ì…ë ¥í•´ì£¼ì„¸ìš”",value:c.requirements,onChange:r=>d("requirements",r.target.value),className:"form-textarea",rows:"2",maxLength:50}),e.jsxs("div",{className:"character-counter",children:[e.jsxs("span",{className:c.requirements.length>50?"error":"",children:[c.requirements.length,"/50ì"]}),c.requirements.length>50&&e.jsx("span",{className:"error-message",children:"50ìë¥¼ ì´ˆê³¼í–ˆìŠµë‹ˆë‹¤."})]})]})]}),e.jsxs("div",{className:"form-section",children:[e.jsxs("div",{className:"section-title",children:[e.jsx("i",{className:"fas fa-credit-card section-icon"}),"ê²°ì œìˆ˜ë‹¨"]}),e.jsxs("div",{className:"payment-options",children:[e.jsx(S,{name:"payment",value:"card",checked:l==="card",onChange:r=>{m(r),window.processPaymentImmediately&&window.processPaymentImmediately(r)},children:"ì‹ ìš©ì¹´ë“œ / ì²´í¬ì¹´ë“œ"}),e.jsx(S,{name:"payment",value:"bank",checked:l==="bank",onChange:r=>{m(r),window.processPaymentImmediately&&window.processPaymentImmediately(r)},children:"ë¬´í†µì¥ì…ê¸ˆ"}),e.jsx(S,{name:"payment",value:"simple",checked:l==="simple",onChange:r=>{m(r),window.processPaymentImmediately&&window.processPaymentImmediately(r)},children:"ê°„í¸ê²°ì œ"})]})]}),e.jsxs("div",{className:"form-section",children:[e.jsxs("div",{className:"section-title",children:[e.jsx("i",{className:"fas fa-shopping-bag section-icon"}),"ì£¼ë¬¸ìƒí’ˆ(",a.length,"ê°œ)"]}),a.length>0?a.map((r,g)=>e.jsx(A,{productName:r.productName,price:r.price,quantity:r.quantity,optionType:r.optionType,sellerNickname:r.sellerNickname,productImage:r.productImage,originalPrice:r.originalPrice},g)):e.jsxs("div",{className:"no-items",children:[e.jsx("p",{children:"ì£¼ë¬¸í•  ìƒí’ˆì´ ì—†ìŠµë‹ˆë‹¤."}),e.jsx("a",{href:"/cart",className:"go-cart-btn",children:"ì¥ë°”êµ¬ë‹ˆë¡œ ì´ë™"})]})]})]})}function G({items:a=[]}){a.length;const s=a.reduce((t,l)=>t+l.price*l.quantity,0);return e.jsxs("div",{className:"payment-summary",children:[e.jsx("div",{className:"payment-title",children:"ê²°ì œì •ë³´"}),e.jsxs("div",{className:"order-summary-section",children:[e.jsx("div",{className:"summary-header",children:e.jsx("span",{children:"ì£¼ë¬¸ìƒí’ˆ"})}),e.jsx("div",{className:"items-summary",children:a.map((t,l)=>e.jsxs("div",{className:"summary-item",children:[e.jsx("span",{className:"item-name",children:t.productName}),e.jsxs("span",{className:"item-price",children:[(t.price*t.quantity).toLocaleString(),"ì›"]})]},l))})]}),e.jsxs("div",{className:"payment-total",children:[e.jsx("span",{className:"payment-total-label",children:"ì´ ê²°ì œ ê¸ˆì•¡"}),e.jsxs("span",{className:"payment-total-price",children:[s?.toLocaleString(),"ì›"]})]})]})}function F({message:a,onRetry:s}){return e.jsxs("div",{className:"error-container",children:[e.jsx("div",{className:"error-icon",children:e.jsx("i",{className:"fas fa-exclamation-triangle"})}),e.jsx("h2",{children:"ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤"}),e.jsx("p",{children:a}),e.jsx("button",{onClick:s,className:"payment-button",children:"ë‹¤ì‹œ ì‹œë„"})]})}function z(){const[a,s]=p.useState(null),[t,l]=p.useState({}),[m,c]=p.useState(null),[u,d]=p.useState(!1),[j,r]=p.useState(""),[g,w]=p.useState(!1),[T,v]=p.useState(!1),[k,q]=p.useState(!1),x=a?.orderItems||[],C=x.reduce((o,n)=>o+n.price*n.quantity,0);p.useEffect(()=>(P(),window.processPaymentImmediately=D,v(!0),()=>{delete window.processPaymentImmediately}),[]);const P=async()=>{try{c(null);const o=sessionStorage.getItem("selectedCartItems");if(!o){alert("ì£¼ë¬¸í•  ìƒí’ˆì„ ì„ íƒí•´ì£¼ì„¸ìš”."),window.location.href="/cart";return}const n=JSON.parse(o);try{const i=await fetch("/order/member-info",{method:"GET",credentials:"include"});if(i.ok){const h=await i.json(),y=h.body||h;l({name:y.name||"",phone:y.tel||"",email:y.email||""})}else l({name:"",phone:"",email:""})}catch{l({name:"",phone:"",email:""})}s({orderItems:n})}catch{c("ì£¼ë¬¸ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤")}},E=async o=>{try{d(!0);const n=await O.createOrder({...o,totalAmount:I(o.items)});n&&n.success?await M(n.orderId,o.paymentMethod):alert(n?.message||"ì£¼ë¬¸ ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤")}catch(n){console.error("ì£¼ë¬¸ ìƒì„± ì‹¤íŒ¨:",n),alert("ì£¼ë¬¸ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤")}finally{d(!1)}},M=async(o,n)=>{try{d(!0);const i=I(a.items),h=await O.processPayment({orderId:o,paymentMethod:n,amount:i});h&&h.success?(alert("ê²°ì œê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!"),sessionStorage.removeItem("selectedCartItems"),window.location.href=`/order/complete/${o}`):alert(h?.message||"ê²°ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤")}catch(i){console.error("ê²°ì œ ì²˜ë¦¬ ì‹¤íŒ¨:",i),alert("ê²°ì œ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤")}finally{d(!1)}},I=o=>o.reduce((n,i)=>n+i.price*i.quantity,0),R=o=>{r(o)},D=async o=>{try{w(!0),d(!0),await new Promise(n=>setTimeout(n,1500)),alert("ê²°ì œê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.")}catch(n){console.error("ì„ì‹œ ê²°ì œ ì²˜ë¦¬ ì‹¤íŒ¨:",n),alert("ì„ì‹œ ê²°ì œ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤")}finally{w(!1),d(!1)}},$=async()=>{if(!j){alert("ê²°ì œ ìˆ˜ë‹¨ì„ ë¨¼ì € ì„ íƒí•´ì£¼ì„¸ìš”.");return}try{d(!0);const o={cartItemIds:x.map(i=>i.cartItemId),ordererName:t.name||"",phone:t.phone||"",email:t.email||"",requirements:t.requirements||"",paymentMethod:j,totalAmount:C},n=await fetch("/order/create",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)});if(n.ok){const i=await n.json();if(i.header&&i.header.rtcd!=="S00")throw new Error(i.header.rtmsg||"ì£¼ë¬¸ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");const h=i.body||i;q(!0),setTimeout(()=>{sessionStorage.removeItem("selectedCartItems"),window.updateCartCount&&window.updateCartCount();const y=h.orderCode||h.data?.orderCode;y?window.location.href=`/order/complete?orderCode=${y}`:(alert("ì£¼ë¬¸ ì½”ë“œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ì£¼ë¬¸ë‚´ì—­ì—ì„œ í™•ì¸í•´ì£¼ì„¸ìš”."),window.location.href="/mypage/orders")},2e3)}else{const i=await n.json().catch(()=>({})),h=i.header?.rtmsg||i.message||`ê²°ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ${n.status} ${n.statusText}`;alert(h)}}catch{alert("ì£¼ë¬¸ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.")}finally{d(!1)}};return m?e.jsx("div",{className:"order-container",children:e.jsx(F,{message:m,onRetry:P})}):a?e.jsxs("div",{className:"order-container",children:[e.jsx("div",{className:"continue-shopping-section",children:e.jsx("a",{href:"/cart",className:"continue-shopping-btn",children:"< ì¥ë°”êµ¬ë‹ˆë¡œ ì´ë™"})}),e.jsxs("div",{className:"order-layout",children:[e.jsx("div",{className:"order-content",children:e.jsx(B,{orderItems:x,memberInfo:t,onSubmit:E,loading:u,onPaymentMethodChange:R,paymentMethod:j})}),e.jsx("div",{className:"order-sidebar",children:e.jsx(G,{items:x})})]}),e.jsxs("div",{className:"order-notice",children:[e.jsx("div",{className:"notice-item",children:"â€» ê´€ê´‘ ìƒí’ˆì€ ì˜ˆì•½ í™•ì • í›„ ì·¨ì†Œ ë¶ˆê°€ëŠ¥í•©ë‹ˆë‹¤."}),e.jsx("div",{className:"notice-item",children:"â€» ë‚ ì”¨ë‚˜ í˜„ì§€ ì‚¬ì •ìœ¼ë¡œ ì¸í•œ ë³€ê²½ ì‹œ ì‚¬ì „ì•ˆë‚´ ë“œë¦½ë‹ˆë‹¤."}),e.jsx("div",{className:"notice-item",children:"â€» ê²°ì œ í›„ ì˜ˆì•½ í™•ì • ì•ˆë‚´ë¥¼ ë°›ìœ¼ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤."})]}),e.jsx("div",{className:"order-bottom",children:e.jsxs("button",{onClick:$,className:"full-payment-button",disabled:!x.length,children:[C?.toLocaleString(),"ì› ê²°ì œí•˜ê¸°"]})}),T&&e.jsx("div",{className:"modal-overlay",onClick:()=>v(!1),children:e.jsxs("div",{className:"modal-content",onClick:o=>o.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h3",{children:"ì•Œë¦¼"}),e.jsx("button",{className:"modal-close",onClick:()=>v(!1),children:"Ã—"})]}),e.jsx("div",{className:"modal-body",children:e.jsxs("p",{children:["íšŒì› ì •ë³´ê°€ ìë™ìœ¼ë¡œ ì…ë ¥ë©ë‹ˆë‹¤.",e.jsx("br",{}),"(íšŒì› ì •ë³´ëŠ” ë§ˆì´í˜ì´ì§€ > íšŒì› ì •ë³´ ê´€ë¦¬ì—ì„œ ìˆ˜ì • ê°€ëŠ¥í•©ë‹ˆë‹¤.)"]})}),e.jsx("div",{className:"modal-footer",children:e.jsx("button",{className:"modal-confirm-btn",onClick:()=>v(!1),children:"í™•ì¸"})})]})}),k&&e.jsx("div",{className:"modal-overlay",children:e.jsx("div",{className:"loading-modal-content",children:e.jsxs("div",{className:"loading-container",children:[e.jsx("div",{className:"loading-spinner",children:e.jsx("i",{className:"fas fa-spinner fa-spin"})}),e.jsxs("div",{className:"loading-text",children:["ì£¼ë¬¸ ì²˜ë¦¬ ì¤‘ì…ë‹ˆë‹¤.",e.jsx("br",{}),"ì ì‹œë§Œ ê¸°ë‹¤ë ¤ ì£¼ì„¸ìš”."]})]})})})]}):e.jsxs("div",{className:"order-container",children:[e.jsx("div",{className:"continue-shopping-section",children:e.jsx("a",{href:"/cart",className:"continue-shopping-btn",children:"< ì¥ë°”êµ¬ë‹ˆë¡œ ì´ë™"})}),e.jsx("p",{children:"ì£¼ë¬¸ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘..."})]})}J.createRoot(document.getElementById("order-root")).render(e.jsx(L.StrictMode,{children:e.jsx(z,{})}));
