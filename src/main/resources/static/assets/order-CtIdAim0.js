import{r as p,j as e,R as q,a as E}from"./client-DJIKB08a.js";const u=async a=>{if(a.status===401)return window.location.href="/login",null;try{return await a.json()}catch(s){throw console.error("JSON 파싱 오류:",s),new Error("서버 응답을 처리할 수 없습니다")}},y=(a,s)=>{throw console.error(`${s} 실패:`,a),a},O={async getOrderInfo(){try{const a=await fetch("/order/info",{method:"GET",headers:{"Content-Type":"application/json"}});return await u(a)}catch(a){y(a,"주문 정보 조회")}},async createOrder(a){try{const s=await fetch("/order/create",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});return await u(s)}catch(s){y(s,"주문 생성")}},async processPayment(a){try{const s=await fetch("/order/payment",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});return await u(s)}catch(s){y(s,"결제 처리")}},async getOrderDetail(a){try{const s=await fetch(`/order/${a}`,{method:"GET",headers:{"Content-Type":"application/json"}});return await u(s)}catch(s){y(s,"주문 상세 조회")}},async cancelOrder(a,s){try{const l=await fetch(`/order/${a}/cancel`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({reason:s})});return await u(l)}catch(l){y(l,"주문 취소")}}};function f({label:a,placeholder:s,value:l,onChange:t,type:o="text",required:n=!1,disabled:d=!1}){return e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:a}),e.jsx("input",{type:o,placeholder:s,value:l,onChange:r=>t(r.target.value),required:n,disabled:d,className:"form-input"})]})}function g({name:a,value:s,checked:l,onChange:t,children:o,description:n}){return e.jsxs("div",{className:`payment-option ${l?"selected":""}`,onClick:()=>t(s),children:[e.jsx("input",{type:"radio",name:a,value:s,checked:l,onChange:()=>t(s),className:"payment-radio"}),e.jsxs("div",{className:"payment-content",children:[e.jsx("div",{className:"payment-label",children:o}),n&&e.jsx("div",{className:"payment-description",children:n})]})]})}function R({productName:a,price:s,quantity:l,seller:t,productImage:o,description:n}){return e.jsxs("div",{className:"order-item",children:[e.jsx("div",{className:"order-item-image",children:o?e.jsx("img",{src:o,alt:a,loading:"lazy",onError:d=>{d.target&&(d.target.style.display="none",d.target.nextSibling&&(d.target.nextSibling.style.display="block"))}}):e.jsx("div",{className:"no-image",children:"이미지 없음"})}),e.jsxs("div",{className:"order-item-info",children:[e.jsx("div",{className:"order-item-title",children:a}),e.jsx("div",{className:"order-item-description",children:n||"상세설명입니다."}),e.jsxs("div",{className:"order-item-meta",children:["경비 • 예약 • ",t]})]}),e.jsxs("div",{className:"order-item-quantity",children:["수량: ",l,"개"]}),e.jsxs("div",{className:"order-item-price",children:[(s*l).toLocaleString(),"원"]})]})}function D({orderItems:a=[],memberInfo:s={},onSubmit:l}){const[t,o]=p.useState({ordererName:s.name||"",phone:s.phone||"",email:s.email||"",requirements:"",paymentMethod:"card"}),n=(r,m)=>{o(x=>({...x,[r]:m}))},d=r=>{if(r.preventDefault(),!t.ordererName||!t.phone||!t.email){alert("필수 정보를 모두 입력해주세요.");return}if(!t.paymentMethod){alert("결제수단을 선택해주세요.");return}l({...t,items:a})};return e.jsxs("form",{onSubmit:d,className:"order-form",children:[e.jsxs("div",{className:"form-section",children:[e.jsxs("div",{className:"section-title",children:[e.jsx("i",{className:"fas fa-user section-icon"}),"주문자 정보"]}),e.jsx(f,{label:"주문자명",placeholder:"주문자명 입력 (수정불가)",value:t.ordererName,onChange:r=>n("ordererName",r),disabled:!!s.name}),e.jsx(f,{label:"연락처",placeholder:"010-1234-5678(수정불가)",value:t.phone,onChange:r=>n("phone",r),disabled:!!s.phone}),e.jsx(f,{label:"이메일",type:"email",placeholder:"moomoo@noomssom.co.kr(수정불가)",value:t.email,onChange:r=>n("email",r),disabled:!!s.email}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"요청사항"}),e.jsx("textarea",{placeholder:"요청사항을 입력해주세요",value:t.requirements,onChange:r=>n("requirements",r.target.value),className:"form-textarea",rows:"3"})]})]}),e.jsxs("div",{className:"form-section",children:[e.jsxs("div",{className:"section-title",children:[e.jsx("i",{className:"fas fa-credit-card section-icon"}),"결제수단"]}),e.jsxs("div",{className:"payment-options",children:[e.jsx(g,{name:"payment",value:"card",checked:t.paymentMethod==="card",onChange:r=>n("paymentMethod",r),children:"신용카드 / 체크카드"}),e.jsx(g,{name:"payment",value:"bank",checked:t.paymentMethod==="bank",onChange:r=>n("paymentMethod",r),children:"무통장입금"}),e.jsx(g,{name:"payment",value:"simple",checked:t.paymentMethod==="simple",onChange:r=>n("paymentMethod",r),children:"간편결제"})]})]}),e.jsxs("div",{className:"form-section",children:[e.jsxs("div",{className:"section-title",children:[e.jsx("i",{className:"fas fa-shopping-bag section-icon"}),"주문상품(",a.length,"개)"]}),a.length>0?a.map((r,m)=>e.jsx(R,{productName:r.productName,price:r.price,quantity:r.quantity,seller:r.seller||"판매자",productImage:r.productImage,description:r.description},m)):e.jsxs("div",{className:"no-items",children:[e.jsx("p",{children:"주문할 상품이 없습니다."}),e.jsx("a",{href:"/cart",className:"go-cart-btn",children:"장바구니로 이동"})]})]})]})}function I({items:a=[],onPayment:s}){const l=a.length,t=a.reduce((o,n)=>o+n.price*n.quantity,0);return e.jsxs("div",{className:"payment-summary",children:[e.jsx("div",{className:"payment-title",children:"결제정보"}),e.jsxs("div",{className:"order-summary-section",children:[e.jsxs("div",{className:"summary-header",children:[e.jsx("span",{children:"주문상품"}),e.jsxs("span",{children:[l,"개"]})]}),e.jsx("div",{className:"items-summary",children:a.map((o,n)=>e.jsxs("div",{className:"summary-item",children:[e.jsx("span",{className:"item-name",children:o.productName}),e.jsxs("span",{className:"item-quantity",children:["×",o.quantity]}),e.jsxs("span",{className:"item-price",children:[(o.price*o.quantity).toLocaleString(),"원"]})]},n))})]}),e.jsx("div",{className:"payment-details",children:e.jsxs("div",{className:"payment-row",children:[e.jsx("span",{children:"상품 금액"}),e.jsxs("span",{children:[t?.toLocaleString(),"원"]})]})}),e.jsxs("div",{className:"payment-total",children:[e.jsx("span",{className:"payment-total-label",children:"총 상품 금액"}),e.jsxs("span",{className:"payment-total-price",children:[t?.toLocaleString(),"원"]})]}),e.jsxs("button",{onClick:s,className:"payment-button",disabled:!a.length,children:[t?.toLocaleString(),"원 결제하기"]})]})}function J({message:a,onRetry:s}){return e.jsxs("div",{className:"error-container",children:[e.jsx("div",{className:"error-icon",children:e.jsx("i",{className:"fas fa-exclamation-triangle"})}),e.jsx("h2",{children:"오류가 발생했습니다"}),e.jsx("p",{children:a}),e.jsx("button",{onClick:s,className:"payment-button",children:"다시 시도"})]})}function L(){const[a,s]=p.useState(null),[l,t]=p.useState({}),[o,n]=p.useState(null),[d,r]=p.useState(!1),[m,x]=p.useState("card"),[M,v]=p.useState(!1),j=a?.orderItems||[],b=j.reduce((c,i)=>c+i.price*i.quantity,0);p.useEffect(()=>{S()},[]);const S=async()=>{try{n(null);const c=sessionStorage.getItem("selectedCartItems");if(!c){alert("주문할 상품을 선택해주세요."),window.location.href="/cart";return}const i=JSON.parse(c),h={name:"홍길동",phone:"010-1234-5678",email:"hong@example.com"};s({items:i}),t(h)}catch(c){console.error("주문 데이터 조회 실패:",c),n("주문 정보를 불러올 수 없습니다")}},P=async c=>{try{r(!0);const i=await O.createOrder({...c,totalAmount:w(c.items)});i&&i.success?await T(i.orderId,c.paymentMethod):alert(i?.message||"주문 생성에 실패했습니다")}catch(i){console.error("주문 생성 실패:",i),alert("주문 처리 중 오류가 발생했습니다")}finally{r(!1)}},T=async(c,i)=>{try{r(!0);const h=w(a.items),N=await O.processPayment({orderId:c,paymentMethod:i,amount:h});N&&N.success?(alert("결제가 완료되었습니다!"),sessionStorage.removeItem("selectedCartItems"),window.location.href=`/order/complete/${c}`):alert(N?.message||"결제에 실패했습니다")}catch(h){console.error("결제 처리 실패:",h),alert("결제 처리 중 오류가 발생했습니다")}finally{r(!1)}},w=c=>c.reduce((i,h)=>i+h.price*h.quantity,0),k=c=>{x(c)},C=async()=>{try{v(!0),r(!0);const c=await fetch("/order/payment",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({paymentMethod:m,totalAmount:b})});if(c.ok){const i=await c.json();alert("결제가 완료되었습니다!"),window.location.href=`/order/complete?orderCode=${i.orderCode}`}else alert("결제에 실패했습니다")}catch(c){console.error("결제 처리 실패:",c),alert("결제 처리 중 오류가 발생했습니다")}finally{v(!1),r(!1)}};return o?e.jsx("div",{className:"order-container",children:e.jsx(J,{message:o,onRetry:S})}):a?e.jsxs("div",{className:"order-container",children:[e.jsxs("div",{className:"breadcrumb",children:[e.jsx("a",{href:"/cart",children:"장바구니"})," >",e.jsx("span",{className:"current",children:" 주문결제"})," >",e.jsx("span",{children:" 주문완료"})]}),e.jsx("h1",{className:"page-title",children:"주문결제"}),e.jsxs("div",{className:"order-layout",children:[e.jsx("div",{className:"order-content",children:e.jsx(D,{orderItems:j,memberInfo:l,onSubmit:P,loading:d,onPaymentMethodChange:k})}),e.jsx("div",{className:"order-sidebar",children:e.jsx(I,{items:j,onPayment:C})})]}),e.jsx("div",{className:"order-bottom",children:e.jsxs("button",{onClick:C,className:"full-payment-button",disabled:!j.length,children:[b?.toLocaleString(),"원 결제하기"]})}),M&&e.jsx("div",{className:"payment-modal-overlay",children:e.jsxs("div",{className:"payment-modal",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("h3",{children:"결제 진행 중..."}),e.jsxs("p",{children:[m==="card"?"신용카드":m==="bank"?"무통장입금":m==="simple"?"간편결제":"결제"," 결제를 처리하고 있습니다"]})]})})]}):e.jsxs("div",{className:"order-container",children:[e.jsxs("div",{className:"breadcrumb",children:[e.jsx("a",{href:"/cart",children:"장바구니"})," >",e.jsx("span",{className:"current",children:" 주문결제"})," >",e.jsx("span",{children:" 주문완료"})]}),e.jsx("h1",{className:"page-title",children:"주문결제"}),e.jsx("p",{children:"주문 정보를 불러오는 중..."})]})}q.createRoot(document.getElementById("order-root")).render(e.jsx(E.StrictMode,{children:e.jsx(L,{})}));
