import{r as h,j as e,R as M,a as k}from"./client-DJIKB08a.js";const u=async a=>{if(a.status===401)return window.location.href="/login",null;try{return await a.json()}catch(s){throw console.error("JSON 파싱 오류:",s),new Error("서버 응답을 처리할 수 없습니다")}},j=(a,s)=>{throw console.error(`${s} 실패:`,a),a},w={async getOrderInfo(){try{const a=await fetch("/order/info",{method:"GET",headers:{"Content-Type":"application/json"}});return await u(a)}catch(a){j(a,"주문 정보 조회")}},async createOrder(a){try{const s=await fetch("/order/create",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});return await u(s)}catch(s){j(s,"주문 생성")}},async processPayment(a){try{const s=await fetch("/order/payment",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});return await u(s)}catch(s){j(s,"결제 처리")}},async getOrderDetail(a){try{const s=await fetch(`/order/${a}`,{method:"GET",headers:{"Content-Type":"application/json"}});return await u(s)}catch(s){j(s,"주문 상세 조회")}},async cancelOrder(a,s){try{const c=await fetch(`/order/${a}/cancel`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({reason:s})});return await u(c)}catch(c){j(c,"주문 취소")}}};function x({label:a,placeholder:s,value:c,onChange:n,type:o="text",required:t=!1,disabled:d=!1}){return e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{className:"form-label",children:[t&&e.jsx("span",{className:"required",children:"*"}),a]}),e.jsx("input",{type:o,placeholder:s,value:c,onChange:r=>n(r.target.value),required:t,disabled:d,className:"form-input"})]})}function g({name:a,value:s,checked:c,onChange:n,children:o,description:t}){return e.jsxs("div",{className:`payment-option ${c?"selected":""}`,onClick:()=>n(s),children:[e.jsx("input",{type:"radio",name:a,value:s,checked:c,onChange:()=>n(s),className:"payment-radio"}),e.jsxs("div",{className:"payment-content",children:[e.jsx("div",{className:"payment-label",children:o}),t&&e.jsx("div",{className:"payment-description",children:t})]})]})}function q({productName:a,price:s,quantity:c,seller:n,productImage:o,description:t}){return e.jsxs("div",{className:"order-item",children:[e.jsx("div",{className:"order-item-image",children:o?e.jsx("img",{src:o,alt:a}):e.jsx("span",{children:"이미지"})}),e.jsxs("div",{className:"order-item-info",children:[e.jsx("div",{className:"order-item-title",children:a}),e.jsx("div",{className:"order-item-description",children:t||"상세설명입니다."}),e.jsxs("div",{className:"order-item-meta",children:["경비 • 예약 • ",n]})]}),e.jsxs("div",{className:"order-item-quantity",children:["수량: ",c,"개"]}),e.jsxs("div",{className:"order-item-price",children:[(s*c).toLocaleString(),"원"]})]})}function P({orderItems:a=[],memberInfo:s={},onSubmit:c}){const[n,o]=h.useState({ordererName:s.name||"",phone:s.phone||"",email:s.email||"",requirements:"",paymentMethod:"card"}),t=(r,p)=>{o(y=>({...y,[r]:p}))},d=r=>{if(r.preventDefault(),!n.ordererName||!n.phone||!n.email){alert("필수 정보를 모두 입력해주세요.");return}if(!n.paymentMethod){alert("결제수단을 선택해주세요.");return}c({...n,items:a})};return e.jsxs("form",{onSubmit:d,className:"order-form",children:[e.jsxs("div",{className:"form-section",children:[e.jsxs("div",{className:"section-title",children:[e.jsx("i",{className:"fas fa-user section-icon"}),"주문자 정보"]}),e.jsxs("div",{className:"form-row",children:[e.jsx(x,{label:"주문자명",placeholder:"주문자명 입력 (수정불가)",value:n.ordererName,onChange:r=>t("ordererName",r),required:!0,disabled:!!s.name}),e.jsx(x,{label:"연락처",placeholder:"010-1234-5678(수정불가)",value:n.phone,onChange:r=>t("phone",r),required:!0,disabled:!!s.phone})]}),e.jsx(x,{label:"이메일",type:"email",placeholder:"moomoo@noomssom.co.kr(수정불가)",value:n.email,onChange:r=>t("email",r),required:!0,disabled:!!s.email}),e.jsx(x,{label:"요구사항",placeholder:"요구사항을 입력해주세요",value:n.requirements,onChange:r=>t("requirements",r)})]}),e.jsxs("div",{className:"form-section",children:[e.jsxs("div",{className:"section-title",children:[e.jsx("i",{className:"fas fa-credit-card section-icon"}),"결제수단"]}),e.jsxs("div",{className:"payment-options",children:[e.jsx(g,{name:"payment",value:"card",checked:n.paymentMethod==="card",onChange:r=>t("paymentMethod",r),description:"무이자 할부 가능",children:"신용카드 / 체크카드"}),e.jsx(g,{name:"payment",value:"bank",checked:n.paymentMethod==="bank",onChange:r=>t("paymentMethod",r),description:"입금 확인 후 예약 확정",children:"무통장 입금"}),e.jsx(g,{name:"payment",value:"kakao",checked:n.paymentMethod==="kakao",onChange:r=>t("paymentMethod",r),description:"간편하고 안전한 결제",children:"카카오페이"})]})]}),e.jsxs("div",{className:"form-section",children:[e.jsxs("div",{className:"section-title",children:[e.jsx("i",{className:"fas fa-shopping-bag section-icon"}),"주문상품(",a.length,"개)"]}),a.length>0?a.map((r,p)=>e.jsx(q,{productName:r.productName,price:r.price,quantity:r.quantity,seller:r.seller||"판매자",productImage:r.productImage,description:r.description},p)):e.jsxs("div",{className:"no-items",children:[e.jsx("p",{children:"주문할 상품이 없습니다."}),e.jsx("a",{href:"/cart",className:"go-cart-btn",children:"장바구니로 이동"})]})]}),e.jsxs("div",{className:"form-actions",children:[e.jsx("button",{type:"button",onClick:()=>window.location.href="/cart",className:"back-button",children:"장바구니로 돌아가기"}),e.jsx("button",{type:"submit",className:"submit-button",disabled:a.length===0,children:"주문하기"})]})]})}function T({items:a=[],onPayment:s,paymentMethod:c="card"}){const n=a.length,o=a.reduce((t,d)=>t+d.price*d.quantity,0);return e.jsxs("div",{className:"payment-summary",children:[e.jsx("div",{className:"payment-title",children:"결제정보"}),e.jsxs("div",{className:"order-summary-section",children:[e.jsxs("div",{className:"summary-header",children:[e.jsx("span",{children:"주문상품"}),e.jsxs("span",{children:[n,"개"]})]}),e.jsx("div",{className:"items-summary",children:a.map((t,d)=>e.jsxs("div",{className:"summary-item",children:[e.jsx("span",{className:"item-name",children:t.productName}),e.jsxs("span",{className:"item-quantity",children:["×",t.quantity]}),e.jsxs("span",{className:"item-price",children:[(t.price*t.quantity).toLocaleString(),"원"]})]},d))})]}),e.jsx("div",{className:"payment-details",children:e.jsxs("div",{className:"payment-row",children:[e.jsx("span",{children:"상품 금액"}),e.jsxs("span",{children:[o?.toLocaleString(),"원"]})]})}),e.jsxs("div",{className:"payment-total",children:[e.jsx("span",{className:"payment-total-label",children:"총 상품 금액"}),e.jsxs("span",{className:"payment-total-price",children:[o?.toLocaleString(),"원"]})]}),e.jsxs("button",{onClick:()=>s(o),className:"payment-button",disabled:a.length===0,children:[o?.toLocaleString(),"원 결제하기"]})]})}function E({message:a,onRetry:s}){return e.jsxs("div",{className:"error-container",children:[e.jsx("div",{className:"error-icon",children:e.jsx("i",{className:"fas fa-exclamation-triangle"})}),e.jsx("h2",{children:"오류가 발생했습니다"}),e.jsx("p",{children:a}),e.jsx("button",{onClick:s,className:"payment-button",children:"다시 시도"})]})}function R(){const[a,s]=h.useState(null),[c,n]=h.useState({}),[o,t]=h.useState(null),[d,r]=h.useState(!1),[p,y]=h.useState("card");h.useEffect(()=>{v()},[]);const v=async()=>{try{t(null);const i=sessionStorage.getItem("selectedCartItems");if(!i){alert("주문할 상품을 선택해주세요."),window.location.href="/cart";return}const l=JSON.parse(i),m={name:"홍길동",phone:"010-1234-5678",email:"hong@example.com"};s({items:l}),n(m)}catch(i){console.error("주문 데이터 조회 실패:",i),t("주문 정보를 불러올 수 없습니다")}},b=async i=>{try{r(!0);const l=await w.createOrder({...i,totalAmount:S(i.items)});l&&l.success?await C(l.orderId,i.paymentMethod):alert(l?.message||"주문 생성에 실패했습니다")}catch(l){console.error("주문 생성 실패:",l),alert("주문 처리 중 오류가 발생했습니다")}finally{r(!1)}},C=async(i,l)=>{try{r(!0);const m=S(a.items),f=await w.processPayment({orderId:i,paymentMethod:l,amount:m});f&&f.success?(alert("결제가 완료되었습니다!"),sessionStorage.removeItem("selectedCartItems"),window.location.href=`/order/complete/${i}`):alert(f?.message||"결제에 실패했습니다")}catch(m){console.error("결제 처리 실패:",m),alert("결제 처리 중 오류가 발생했습니다")}finally{r(!1)}},S=i=>i.reduce((l,m)=>l+m.price*m.quantity,0),O=i=>{y(i)},N=a?.items||[];return o?e.jsx("div",{className:"order-container",children:e.jsx(E,{message:o,onRetry:v})}):a?e.jsxs("div",{className:"order-container",children:[e.jsxs("div",{className:"breadcrumb",children:[e.jsx("a",{href:"/cart",children:"장바구니"})," >",e.jsx("span",{className:"current",children:" 주문결제"})," >",e.jsx("span",{children:" 주문완료"})]}),e.jsx("h1",{className:"page-title",children:"주문결제"}),e.jsxs("div",{className:"order-layout",children:[e.jsx("div",{className:"order-content",children:e.jsx(P,{orderItems:N,memberInfo:c,onSubmit:b,loading:d,onPaymentMethodChange:O})}),e.jsx("div",{className:"order-sidebar",children:e.jsx(T,{items:N,onPayment:i=>{const l={ordererName:c.name,phone:c.phone,email:c.email,requirements:"",paymentMethod:p,items:N};b(l)},paymentMethod:p})})]})]}):e.jsxs("div",{className:"order-container",children:[e.jsxs("div",{className:"breadcrumb",children:[e.jsx("a",{href:"/cart",children:"장바구니"})," >",e.jsx("span",{className:"current",children:" 주문결제"})," >",e.jsx("span",{children:" 주문완료"})]}),e.jsx("h1",{className:"page-title",children:"주문결제"}),e.jsx("p",{children:"주문 정보를 불러오는 중..."})]})}M.createRoot(document.getElementById("order-root")).render(e.jsx(k.StrictMode,{children:e.jsx(R,{})}));
